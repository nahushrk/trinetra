{% extends "base.html" %}

{% block title %}{{ folder_name }} - Trinetra 3D Model Manager{% endblock %}

{% block extra_head %}
<!-- Include GCodeLoader -->
<script src="https://cdn.jsdelivr.net/npm/three@0.110/examples/js/loaders/GCodeLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.110/examples/js/utils/BufferGeometryUtils.js"></script>
{% endblock %}

{% block content %}
<!-- Folder Name and Action Buttons -->
<div class="row justify-content-center align-items-center">
    <div class="col text-center">
        <h2 data-test-id="folder-name">{{ folder_name }}</h2>
    </div>
</div>
<!-- Action Buttons -->
<div class="row justify-content-center mb-3">
    <div class="col text-center">
        <button id="delete-folder-btn" class="btn btn-danger mr-2" data-test-id="delete-folder-btn">
            <i class="bi bi-trash"></i> Delete Folder
        </button>
        <button id="download-folder-btn" class="btn btn-primary" data-test-id="download-folder-btn">
            <i class="bi bi-download"></i> Download Folder
        </button>
    </div>
</div>

<!-- STL Files Section -->
{% if stl_files %}
<div class="section" data-test-id="stl-section">
    <h3>Model Files (STL)</h3>
    <canvas id="c" class="d-block mx-auto" data-test-id="3d-canvas"></canvas>
    <div id="stl-content" class="mt-4" data-test-id="stl-content"></div>
</div>
{% endif %}

<!-- G-code Files Section -->
{% if gcode_files %}
<div class="section" data-test-id="gcode-section">
    <h3>Sliced Files (G-code)</h3>
    <div id="gcode-content" class="mt-4" data-test-id="gcode-content"></div>
</div>
{% endif %}

<!-- Images Section -->
{% if image_files %}
<div class="section" data-test-id="image-section">
    <h3>Images</h3>
    <div id="image-content" class="mt-4" data-test-id="image-content"></div>
</div>
{% endif %}

<!-- PDFs Section -->
{% if pdf_files %}
<div class="section" data-test-id="pdf-section">
    <h3>PDFs</h3>
    <div id="pdf-content" class="mt-4" data-test-id="pdf-content"></div>
</div>
{% endif %}

<!-- Image Modal -->
<div id="image-modal" class="modal" data-test-id="image-modal">
    <span class="close" data-test-id="modal-close-btn">&times;</span>
    <div id="modal-content-wrapper" data-test-id="modal-content">
        <img class="modal-content" id="modal-image" data-test-id="modal-image">
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const stlFiles = {{ stl_files|tojson }};
    const imageFiles = {{ image_files|tojson }};
    const pdfFiles = {{ pdf_files|tojson }};
    const gcodeFiles = {{ gcode_files|tojson }};
    const folderName = "{{ folder_name }}";
</script>
<script src="{{ url_for('static', filename='js/shared_3d_renderer.js') }}"></script>
<script src="{{ url_for('static', filename='js/folder_view.js') }}"></script>
{% endblock %}
